<!DOCTYPE html>
<html>
<head>
    <title>Relayr Test Page</title>

    <script src="https://developer.relayr.io/relayr-browser-sdk.min.js"></script>
    <script src="http://code.jquery.com/jquery-1.11.2.min.js"></script>
    
    <script type="text/javascript">

        var lastVals = [0.0,0.0,0.0,0.0,0.0];

        var relayr = RELAYR.init({
            appId: "71407337-1f21-406a-9529-e58151979915"
        });
        
        // accelerometer
        relayr.devices().getDeviceData(
        {
            deviceId: "67c656c3-08d3-43ff-be2a-d434f07dd61e", 
            token: "vTP_EUdBJzdrz.digPRyNM82VEuLfqY6",
            incomingData: function(data){
            console.log("sensor",data);
            console.log("Accelerometer X:"+data.accel.x+" Y:"+data.accel.y+" Z:"+data.accel.z);
            console.log("Gyro X:"+data.gyro.x+" Y:"+data.gyro.y+" Z:"+data.gyro.z);
            $('#accel-x').text(data.accel.x);
            $('#accel-y').text(data.accel.y);
            $('#accel-z').text(data.accel.z);
            $('#gyro-x').text(data.gyro.x);
            $('#gyro-y').text(data.gyro.y);
            $('#gyro-z').text(data.gyro.z);
            lastVals.push(data.accel.x);
            lastVals.shift();

            // accel-x if value switches from positive to negative greatly it's shaking
            // a shake is defined as switch from negative to positive and back (or vice versa)
            if(detectShake()) {
                $('#shaked').text("YOUR BABY IS SHAKING");
            }
            else {
                $('#shaked').text("Your baby is safe.");
            }
        }
        });   

        function detectShake() {
            var highest = 0.0;
            var lowest = 0.0;
            // find the highest positive number and lowest negative
            // if the difference beween them is > .5, that's a shake
            for(var i=0; i<lastVals.length; i++) {
                var val = lastVals[i];
                if(val > highest)
                    highest = val;
                else if(val < lowest)
                    lowest = val;
            }
            if(highest < 0.1 || lowest > -0.1)
                return false;
            if(highest - lowest > .5)
                return true

            return false;
        }
    </script>
    
</head>

<body>
        Accelerometer
    <div id="accel-x">Nan</div>
    <div id="accel-y">Nan</div>
    <div id="accel-z">Nan</div>
    Gyro

    <div id="gyro-x">Nan</div>
    <div id="gyro-y">Nan</div>
    <div id="gyro-z">Nan</div>

    <div id="shaked">No shake!</div>
</body>

</html>
